// https://people.sc.fsu.edu/~jburkardt/datasets/quadrature_rules_tri/quadrature_rules_tri.html
// https://bthierry.pages.math.cnrs.fr/course/fem/implementation_matrices_elementaires/

import { complex } from './complex';
import { ComplexToRealFunction, Polygon } from './types';
import { det2 } from './vector';

const AREA = 0.5;

const psi1: ComplexToRealFunction = (z) => 1 - z.re - z.im;
const psi2: ComplexToRealFunction = (z) => z.re;
const psi3: ComplexToRealFunction = (z) => z.im;

export const CENTROID = {
  points: [ complex(1/3, 1/3) ],
  weights: [ 1 ],
};

export const SEVEN_POINT = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(1, 0),
    complex(0, 1),
    complex(0, 0),
    complex(0, 0.5),
    complex(0.5, 0),
    complex(0.5, 0.5)
  ],
  weights: [
    0.45,
    0.05,
    0.05,
    0.05,
    0.1333333333333333,
    0.1333333333333333,
    0.1333333333333333
  ],
};

export const VERTEX = {
  points: [
    complex(1, 0),
    complex(0, 1),
    complex(0, 0)
  ],
  weights: [
    0.3333333333333333,
    0.3333333333333333,
    0.3333333333333333
  ],
};

export const STRANG1 = {
  points: [
    complex(0.6666666666666666, 0.16666666666666666),
    complex(0.16666666666666666, 0.6666666666666666),
    complex(0.16666666666666666, 0.16666666666666666)
  ],
  weights: [
    0.3333333333333333,
    0.3333333333333333,
    0.3333333333333333
  ],
};

export const STRANG2 = {
  points: [
    complex(0.5, 0),
    complex(0.5, 0.5),
    complex(0, 0.5)
  ],
  weights: [
    0.3333333333333333,
    0.3333333333333333,
    0.3333333333333333
  ],
};

export const STRANG3 = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(0.6, 0.2),
    complex(0.2, 0.6),
    complex(0.2, 0.2)
  ],
  weights: [
    -0.5625,
    0.5208333333333334,
    0.5208333333333334,
    0.5208333333333334
  ],
};

export const STRANG4 = {
  points: [
    complex(0.659027622374092, 0.231933368553031),
    complex(0.659027622374092, 0.109039009072877),
    complex(0.231933368553031, 0.659027622374092),
    complex(0.231933368553031, 0.109039009072877),
    complex(0.109039009072877, 0.659027622374092),
    complex(0.109039009072877, 0.231933368553031)
  ],
  weights: [
    0.16666666666666666,
    0.16666666666666666,
    0.16666666666666666,
    0.16666666666666666,
    0.16666666666666666,
    0.16666666666666666
  ],
};

export const STRANG5 = {
  points: [
    complex(0.816847572980459, 0.091576213509771),
    complex(0.091576213509771, 0.816847572980459),
    complex(0.091576213509771, 0.091576213509771),
    complex(0.10810301816807, 0.445948490915965),
    complex(0.445948490915965, 0.10810301816807),
    complex(0.445948490915965, 0.445948490915965)
  ],
  weights: [
    0.109951743655322,
    0.109951743655322,
    0.109951743655322,
    0.223381589678011,
    0.223381589678011,
    0.223381589678011
  ],
};

export const STRANG6 = {
  points: [
    complex(0.333333333333333, 0.333333333333333),
    complex(0.736712498968435, 0.237932366472434),
    complex(0.736712498968435, 0.025355134551932),
    complex(0.237932366472434, 0.736712498968435),
    complex(0.237932366472434, 0.025355134551932),
    complex(0.025355134551932, 0.736712498968435),
    complex(0.025355134551932, 0.237932366472434)
  ],
  weights: [
    0.375,
    0.104166666666667,
    0.104166666666667,
    0.104166666666667,
    0.104166666666667,
    0.104166666666667,
    0.104166666666667
  ],
};

export const STRANG7 = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(0.7974269853530872, 0.10128650732345633),
    complex(0.10128650732345633, 0.7974269853530872),
    complex(0.10128650732345633, 0.10128650732345633),
    complex(0.05971587178976981, 0.47014206410511505),
    complex(0.47014206410511505, 0.05971587178976981),
    complex(0.47014206410511505, 0.47014206410511505)
  ],
  weights: [
    0.225,
    0.12593918054482717,
    0.12593918054482717,
    0.12593918054482717,
    0.13239415278850616,
    0.13239415278850616,
    0.13239415278850616
  ],
};

export const STRANG8 = {
  points: [
    complex(0.124949503233232, 0.437525248383384),
    complex(0.437525248383384, 0.124949503233232),
    complex(0.437525248383384, 0.437525248383384),
    complex(0.797112651860071, 0.165409927389841),
    complex(0.797112651860071, 0.037477420750088),
    complex(0.165409927389841, 0.797112651860071),
    complex(0.165409927389841, 0.037477420750088),
    complex(0.037477420750088, 0.797112651860071),
    complex(0.037477420750088, 0.165409927389841)
  ],
  weights: [
    0.205950504760887,
    0.205950504760887,
    0.205950504760887,
    0.063691414286223,
    0.063691414286223,
    0.063691414286223,
    0.063691414286223,
    0.063691414286223,
    0.063691414286223
  ],
};



export const STRANG9 = {
  points: [
    complex(0.873821971016996, 0.063089014491502),
    complex(0.063089014491502, 0.873821971016996),
    complex(0.063089014491502, 0.063089014491502),
    complex(0.501426509658179, 0.249286745170910),
    complex(0.249286745170910, 0.501426509658179),
    complex(0.249286745170910, 0.249286745170910),
    complex(0.636502499121399, 0.310352451033785),
    complex(0.636502499121399, 0.053145049844816),
    complex(0.310352451033785, 0.636502499121399),
    complex(0.310352451033785, 0.053145049844816),
    complex(0.053145049844816, 0.636502499121399),
    complex(0.053145049844816, 0.310352451033785),
  ],
  weights: [
    0.050844906370207,
    0.050844906370207,
    0.050844906370207,
    0.116786275726379,
    0.116786275726379,
    0.116786275726379,
    0.082851075618374,
    0.082851075618374,
    0.082851075618374,
    0.082851075618374,
    0.082851075618374,
    0.082851075618374,
  ],
};

export const STRANG10 = {
  points: [
    complex(0.333333333333333, 0.333333333333333),
    complex(0.479308067841923, 0.260345966079038),
    complex(0.260345966079038, 0.479308067841923),
    complex(0.260345966079038, 0.260345966079038),
    complex(0.869739794195568, 0.065130102902216),
    complex(0.065130102902216, 0.869739794195568),
    complex(0.065130102902216, 0.065130102902216),
    complex(0.638444188569809, 0.312865496004875),
    complex(0.638444188569809, 0.048690315425316),
    complex(0.312865496004875, 0.638444188569809),
    complex(0.312865496004875, 0.048690315425316),
    complex(0.048690315425316, 0.638444188569809),
    complex(0.048690315425316, 0.312865496004875)
  ],
  weights: [
    -0.14957004446767,
    0.175615257433204,
    0.175615257433204,
    0.175615257433204,
    0.053347235608839,
    0.053347235608839,
    0.053347235608839,
    0.077113760890257,
    0.077113760890257,
    0.077113760890257,
    0.077113760890257,
    0.077113760890257,
    0.077113760890257
  ],
};

export const GAUSS4X4 = {
  points: [
    complex(0.0571041961, 0.06546699455602246),
    complex(0.2768430136, 0.05021012321401679),
    complex(0.5835904324, 0.02891208422223085),
    complex(0.8602401357, 0.009703785123906346),
    complex(0.0571041961, 0.311164552249148),
    complex(0.2768430136, 0.2386486597440242),
    complex(0.5835904324, 0.1374191041243166),
    complex(0.8602401357, 0.04612207989200404),
    complex(0.0571041961, 0.631731251650852),
    complex(0.2768430136, 0.4845083266559759),
    complex(0.5835904324, 0.2789904634756834),
    complex(0.8602401357, 0.09363778440799593),
    complex(0.0571041961, 0.8774288093439775),
    complex(0.2768430136, 0.6729468631859832),
    complex(0.5835904324, 0.3874974833777692),
    complex(0.8602401357, 0.1300560791760936)
  ],
  weights: [
    0.04713673637581137,
    0.07077613579259895,
    0.04516809856187617,
    0.01084645180365496,
    0.08837017702418863,
    0.132688432207401,
    0.08467944903812383,
    0.02033451909634504,
    0.08837017702418863,
    0.132688432207401,
    0.08467944903812383,
    0.02033451909634504,
    0.04713673637581137,
    0.07077613579259895,
    0.04516809856187617,
    0.01084645180365496
  ],
};

export const GAUSS8X8 = {
  points: [
    complex(0.95536604471, 0.0008862103848242247),
    complex(0.95536604471, 0.004537789678039195),
    complex(0.95536604471, 0.01058868260117431),
    complex(0.95536604471, 0.01822327082910602),
    complex(0.95536604471, 0.02641068446089399),
    complex(0.95536604471, 0.03404527268882569),
    complex(0.95536604471, 0.0400961656119608),
    complex(0.95536604471, 0.04374774490517578),
    complex(0.85563374296, 0.002866402391985981),
    complex(0.85563374296, 0.01467724979327651),
    complex(0.85563374296, 0.0342485550335843),
    complex(0.85563374296, 0.05894224214571626),
    complex(0.85563374296, 0.08542401489428375),
    complex(0.85563374296, 0.1101177020064157),
    complex(0.85563374296, 0.1296890072467235),
    complex(0.85563374296, 0.141499854648014),
    complex(0.71317524286, 0.005694926133044352),
    complex(0.71317524286, 0.02916054411712861),
    complex(0.71317524286, 0.068044525648275),
    complex(0.71317524286, 0.1171055801775613),
    complex(0.71317524286, 0.1697191769624387),
    complex(0.71317524286, 0.218780231491725),
    complex(0.71317524286, 0.2576642130228714),
    complex(0.71317524286, 0.2811298310069557),
    complex(0.5451866848, 0.00903035100671163),
    complex(0.5451866848, 0.04623939674940125),
    complex(0.5451866848, 0.1078970888004545),
    complex(0.5451866848, 0.1856923986620134),
    complex(0.5451866848, 0.2691209165379867),
    complex(0.5451866848, 0.3469162263995455),
    complex(0.5451866848, 0.4085739184505988),
    complex(0.5451866848, 0.4457829641932884),
    complex(0.37193216458, 0.01247033193690498),
    complex(0.37193216458, 0.06385362269957356),
    complex(0.37193216458, 0.1489989161403976),
    complex(0.37193216458, 0.2564292182833579),
    complex(0.37193216458, 0.3716386171366422),
    complex(0.37193216458, 0.4790689192796024),
    complex(0.37193216458, 0.5642142127204264),
    complex(0.37193216458, 0.615597503483095),
    complex(0.2143084794, 0.01559996151584746),
    complex(0.2143084794, 0.07987871227492103),
    complex(0.2143084794, 0.1863925811641285),
    complex(0.2143084794, 0.3207842387034378),
    complex(0.2143084794, 0.4649072818965623),
    complex(0.2143084794, 0.5992989394358715),
    complex(0.2143084794, 0.705812808325079),
    complex(0.2143084794, 0.7700915590841526),
    complex(0.09132360790000005, 0.01804183496379599),
    complex(0.09132360790000005, 0.09238218584838476),
    complex(0.09132360790000005, 0.215568748962806),
    complex(0.09132360790000005, 0.3709968314854498),
    complex(0.09132360790000005, 0.5376795606145502),
    complex(0.09132360790000005, 0.693107643137194),
    complex(0.09132360790000005, 0.8162942062516152),
    complex(0.09132360790000005, 0.890634557136204),
    complex(0.01777991514999999, 0.01950205026019779),
    complex(0.01777991514999999, 0.09985913490381848),
    complex(0.01777991514999999, 0.2330157982952792),
    complex(0.01777991514999999, 0.4010234473667467),
    complex(0.01777991514999999, 0.5811966374832533),
    complex(0.01777991514999999, 0.7492042865547208),
    complex(0.01777991514999999, 0.8823609499461815),
    complex(0.01777991514999999, 0.9627180345898023)
  ],
  weights: [
    0.0003335674062677772,
    0.0007327880811491046,
    0.001033723454167925,
    0.001195112498415193,
    0.001195112498415193,
    0.001033723454167925,
    0.0007327880811491046,
    0.0003335674062677772,
    0.001806210919443461,
    0.003967923151181667,
    0.005597437146194232,
    0.006471331443180639,
    0.006471331443180639,
    0.005597437146194232,
    0.003967923151181667,
    0.001806210919443461,
    0.004599755803015752,
    0.01010484287526739,
    0.01425461651131868,
    0.01648010431039818,
    0.01648010431039818,
    0.01425461651131868,
    0.01010484287526739,
    0.004599755803015752,
    0.00801725953115673,
    0.01761248886287915,
    0.02484544071087993,
    0.02872441038508419,
    0.02872441038508419,
    0.02484544071087993,
    0.01761248886287915,
    0.00801725953115673,
    0.01073501897357062,
    0.02358292149331603,
    0.03326776143412911,
    0.03846165753898425,
    0.03846165753898425,
    0.03326776143412911,
    0.02358292149331603,
    0.01073501897357062,
    0.01138879740452669,
    0.02501915606814251,
    0.03529381699354388,
    0.04080402900378691,
    0.04080402900378691,
    0.03529381699354388,
    0.02501915606814251,
    0.01138879740452669,
    0.009223845391285393,
    0.02026314273544469,
    0.02858464328177232,
    0.03304739223149761,
    0.03304739223149761,
    0.02858464328177232,
    0.02026314273544469,
    0.009223845391285393,
    0.004509812715921713,
    0.009907253959306707,
    0.01397588340693756,
    0.01615785427783403,
    0.01615785427783403,
    0.01397588340693756,
    0.009907253959306707,
    0.004509812715921713
  ],
};

export const TOMS584_19 = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(0.7974269853530872, 0.1012865073234563),
    complex(0.1012865073234563, 0.7974269853530872),
    complex(0.1012865073234563, 0.1012865073234563),
    complex(0.0597158717897698, 0.4701420641051151),
    complex(0.4701420641051151, 0.0597158717897698),
    complex(0.4701420641051151, 0.4701420641051151),
    complex(0.5357953464498992, 0.2321023267750504),
    complex(0.2321023267750504, 0.5357953464498992),
    complex(0.2321023267750504, 0.2321023267750504),
    complex(0.9410382782311209, 0.0294808608844396),
    complex(0.0294808608844396, 0.9410382782311209),
    complex(0.0294808608844396, 0.0294808608844396),
    complex(0.73841681234051, 0.2321023267750504),
    complex(0.73841681234051, 0.0294808608844396),
    complex(0.2321023267750504, 0.73841681234051),
    complex(0.2321023267750504, 0.0294808608844396),
    complex(0.0294808608844396, 0.73841681234051),
    complex(0.0294808608844396, 0.2321023267750504)
  ],
  weights: [
    0.0378610912003147,
    0.0376204254131829,
    0.0376204254131829,
    0.0376204254131829,
    0.0783573522441174,
    0.0783573522441174,
    0.0783573522441174,
    0.1162714796569659,
    0.1162714796569659,
    0.1162714796569659,
    0.0134442673751655,
    0.0134442673751655,
    0.0134442673751655,
    0.0375097224552317,
    0.0375097224552317,
    0.0375097224552317,
    0.0375097224552317,
    0.0375097224552317,
    0.0375097224552317
  ],
};

export const TOMS612_19 = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(0.02063496160252593, 0.489682519198737),
    complex(0.489682519198737, 0.02063496160252593),
    complex(0.489682519198737, 0.489682519198737),
    complex(0.125820817014129, 0.4370895914929355),
    complex(0.4370895914929355, 0.125820817014129),
    complex(0.4370895914929355, 0.4370895914929355),
    complex(0.6235929287619356, 0.1882035356190322),
    complex(0.1882035356190322, 0.6235929287619356),
    complex(0.1882035356190322, 0.1882035356190322),
    complex(0.9105409732110941, 0.04472951339445297),
    complex(0.04472951339445297, 0.9105409732110941),
    complex(0.04472951339445297, 0.04472951339445297),
    complex(0.741198598784498, 0.03683841205473626),
    complex(0.741198598784498, 0.22196298916076573),
    complex(0.03683841205473626, 0.741198598784498),
    complex(0.03683841205473626, 0.22196298916076573),
    complex(0.22196298916076573, 0.741198598784498),
    complex(0.22196298916076573, 0.03683841205473626)
  ],
  weights: [
    0.0971357962827961,
    0.03133470022713983,
    0.03133470022713983,
    0.03133470022713983,
    0.07782754100477543,
    0.07782754100477543,
    0.07782754100477543,
    0.0796477389272091,
    0.0796477389272091,
    0.0796477389272091,
    0.0255776756586981,
    0.0255776756586981,
    0.0255776756586981,
    0.0432835393772894,
    0.0432835393772894,
    0.0432835393772894,
    0.0432835393772894,
    0.0432835393772894,
    0.0432835393772894
  ],
};

export const TOMS612_28 = {
  points: [
    complex(0.3333333333333333, 0.3333333333333333),
    complex(0.9480217181434233, 0.02598914092828833),
    complex(0.02598914092828833, 0.9480217181434233),
    complex(0.02598914092828833, 0.02598914092828833),
    complex(0.8114249947041546, 0.0942875026479227),
    complex(0.0942875026479227, 0.8114249947041546),
    complex(0.0942875026479227, 0.0942875026479227),
    complex(0.0107264499655706, 0.4946367750172147),
    complex(0.4946367750172147, 0.0107264499655706),
    complex(0.4946367750172147, 0.4946367750172147),
    complex(0.5853132347709715, 0.2073433826145142),
    complex(0.2073433826145142, 0.5853132347709715),
    complex(0.2073433826145142, 0.2073433826145142),
    complex(0.1221843885990187, 0.4389078057004907),
    complex(0.4389078057004907, 0.1221843885990187),
    complex(0.4389078057004907, 0.4389078057004907),
    complex(0.6779376548825902, 0.04484167758913055),
    complex(0.6779376548825902, 0.27722066752827923),
    complex(0.04484167758913055, 0.6779376548825902),
    complex(0.04484167758913055, 0.27722066752827923),
    complex(0.27722066752827923, 0.6779376548825902),
    complex(0.27722066752827923, 0.04484167758913055),
    complex(0.8588702812826364, 0),
    complex(0.8588702812826364, 0.1411297187173636),
    complex(0, 0.8588702812826364),
    complex(0, 0.1411297187173636),
    complex(0.1411297187173636, 0.8588702812826364),
    complex(0.1411297187173636, 0)
  ],
  weights: [
    0.0879773011622219,
    0.00874431155373619,
    0.00874431155373619,
    0.00874431155373619,
    0.03808157199393533,
    0.03808157199393533,
    0.03808157199393533,
    0.01885544805613125,
    0.01885544805613125,
    0.01885544805613125,
    0.072159697544741,
    0.072159697544741,
    0.072159697544741,
    0.0693291387055372,
    0.0693291387055372,
    0.0693291387055372,
    0.0410563154292886,
    0.0410563154292886,
    0.0410563154292886,
    0.0410563154292886,
    0.0410563154292886,
    0.0410563154292886,
    0.007362383783300573,
    0.007362383783300573,
    0.007362383783300573,
    0.007362383783300573,
    0.007362383783300573,
    0.007362383783300573
  ],
};

export const TOMS706_37 = {
  points: [
    complex(0.333333333333333333333333333333, 0.333333333333333333333333333333),
    complex(0.950275662924105565450352089520, 0.024862168537947217274823955239),
    complex(0.024862168537947217274823955239, 0.950275662924105565450352089520),
    complex(0.024862168537947217274823955239, 0.024862168537947217274823955239),
    complex(0.171614914923835347556304795551, 0.414192542538082326221847602214),
    complex(0.414192542538082326221847602214, 0.171614914923835347556304795551),
    complex(0.414192542538082326221847602214, 0.414192542538082326221847602214),
    complex(0.539412243677190440263092985511, 0.230293878161404779868453507244),
    complex(0.230293878161404779868453507244, 0.539412243677190440263092985511),
    complex(0.230293878161404779868453507244, 0.230293878161404779868453507244),
    complex(0.772160036676532561750285570113, 0.113919981661733719124857214943),
    complex(0.113919981661733719124857214943, 0.772160036676532561750285570113),
    complex(0.113919981661733719124857214943, 0.113919981661733719124857214943),
    complex(0.009085399949835353883572964740, 0.495457300025082323058213517632),
    complex(0.495457300025082323058213517632, 0.009085399949835353883572964740),
    complex(0.495457300025082323058213517632, 0.495457300025082323058213517632),
    complex(0.062277290305886993497083640527, 0.468861354847056503251458179727),
    complex(0.468861354847056503251458179727, 0.062277290305886993497083640527),
    complex(0.468861354847056503251458179727, 0.468861354847056503251458179727),
    complex(0.022076289653624405142446876931, 0.851306504174348550389457672223),
    complex(0.022076289653624405142446876931, 0.126617206172027096933163647918),
    complex(0.851306504174348550389457672223, 0.022076289653624405142446876931),
    complex(0.851306504174348550389457672223, 0.126617206172027096933163647918),
    complex(0.126617206172027096933163647918, 0.022076289653624405142446876931),
    complex(0.126617206172027096933163647918, 0.851306504174348550389457672223),
    complex(0.018620522802520968955913511549, 0.689441970728591295496647976487),
    complex(0.018620522802520968955913511549, 0.291937506468887771754472382212),
    complex(0.689441970728591295496647976487, 0.018620522802520968955913511549),
    complex(0.689441970728591295496647976487, 0.291937506468887771754472382212),
    complex(0.291937506468887771754472382212, 0.018620522802520968955913511549),
    complex(0.291937506468887771754472382212, 0.689441970728591295496647976487),
    complex(0.096506481292159228736516560903, 0.635867859433872768286976979827),
    complex(0.096506481292159228736516560903, 0.267625659273967961282458816185),
    complex(0.635867859433872768286976979827, 0.096506481292159228736516560903),
    complex(0.635867859433872768286976979827, 0.267625659273967961282458816185),
    complex(0.267625659273967961282458816185, 0.096506481292159228736516560903),
    complex(0.267625659273967961282458816185, 0.635867859433872768286976979827)
  ],
  weights: [
    0.051739766065744133555179145422,
    0.008007799555564801597804123460,
    0.008007799555564801597804123460,
    0.008007799555564801597804123460,
    0.046868898981821644823226732071,
    0.046868898981821644823226732071,
    0.046868898981821644823226732071,
    0.046590940183976487960361770070,
    0.046590940183976487960361770070,
    0.046590940183976487960361770070,
    0.031016943313796381407646220131,
    0.031016943313796381407646220131,
    0.031016943313796381407646220131,
    0.010791612736631273623178240136,
    0.010791612736631273623178240136,
    0.010791612736631273623178240136,
    0.032195534242431618819414482205,
    0.032195534242431618819414482205,
    0.032195534242431618819414482205,
    0.015445834210701583817692900053,
    0.015445834210701583817692900053,
    0.015445834210701583817692900053,
    0.015445834210701583817692900053,
    0.015445834210701583817692900053,
    0.015445834210701583817692900053,
    0.017822989923178661888748319485,
    0.017822989923178661888748319485,
    0.017822989923178661888748319485,
    0.017822989923178661888748319485,
    0.017822989923178661888748319485,
    0.017822989923178661888748319485,
    0.037038683681384627918546472190,
    0.037038683681384627918546472190,
    0.037038683681384627918546472190,
    0.037038683681384627918546472190,
    0.037038683681384627918546472190,
    0.037038683681384627918546472190
  ],
};

export const integrateTriangle = (f: ComplexToRealFunction, triangle: Polygon, scheme = STRANG9) => {
  // area of the triangle
  const a = Math.abs(AREA * det2(triangle[1].re - triangle[0].re, triangle[1].im - triangle[0].im, triangle[2].re - triangle[0].re, triangle[2].im - triangle[0].im));

  let sum = 0;
  for (let i = 0; i < scheme.points.length; i++) {
    const z = triangle[0].mul(psi1(scheme.points[i]))
                .add(triangle[1].mul(psi2(scheme.points[i])))
                .add(triangle[2].mul(psi3(scheme.points[i])));

    sum += f(z) * scheme.weights[i] * a;
  }
  return sum;
};
